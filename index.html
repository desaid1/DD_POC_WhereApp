/* unchanged head and body */

function renderThings() {
  const query = document.getElementById('searchInput').value.toLowerCase();
  const container = document.getElementById('thingsList');
  container.innerHTML = '';

  const filtered = allThings.filter(t => {
    const nameMatch = t.name?.toLowerCase().includes(query);
    const flexMatch = (t.flexibutes || []).some(({ key, val }) =>
      key?.toLowerCase().includes(query) || val?.toLowerCase().includes(query)
    );
    return nameMatch || flexMatch;
  });

  if (filtered.length === 0) {
    container.innerHTML = '<p style="color:#aaa">No matching things found.</p>';
    return;
  }

  filtered.forEach(thing => {
    const div = document.createElement('div');
    div.className = 'thing';

    const mediaImages = (thing.media || [])
      .filter(m => m.includes("http"))
      .map(m => `<img src="${m}" class="media-img">`)
      .join('');

    const details = (thing.flexibutes || [])
      .map(({ key, val }) => `<p><strong>${key}:</strong> ${val}</p>`)
      .join('');

    div.innerHTML = `
      <h3>${thing.name || 'Untitled Thing'}</h3>
      ${mediaImages}<br>
      ${details}
      <p><strong>Location:</strong> ${thing.location?.source || 'Unknown'} (${thing.location?.lat}, ${thing.location?.long})</p>
      <p><strong>Visibility:</strong> ${thing.visibility || 'private'}</p>
      <button class="edit-btn" onclick="location.href='edit.html?id=${thing.id}'">✏️ Edit</button>
    `;

    container.appendChild(div);

    requestAnimationFrame(() => {
      if (div.scrollHeight > 100) {
        const toggleBtn = document.createElement('button');
        toggleBtn.className = 'toggle-details';
        toggleBtn.textContent = 'More';
        toggleBtn.onclick = () => toggleExpand(toggleBtn);

        const fade = document.createElement('div');
        fade.className = 'fade-out';

        div.appendChild(toggleBtn);
        div.appendChild(fade);
      }
    });
  });
}
